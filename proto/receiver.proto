syntax = "proto3";

package proto;

option go_package = "NavControlSystem/proto";

// Импортируем общие определения и стандартные типы
import "service.proto";
import "google/protobuf/wrappers.proto"; // <-- ИМПОРТ ДЛЯ Int32Value

// Сервис управления RECEIVER'ом
service ReceiverControl {
  // Устанавливаем уровень логирования, используя общий запрос/ответ
  rpc SetLogLevel(proto.SetLogLevelRequest) returns (proto.SetLogLevelResponse);

  // Получить статус сервиса
  rpc GetStatus(GetStatusRequest) returns (GetStatusResponse);

  // Получить количество активных подключений
  rpc GetActiveConnectionsCount(GetClientsRequest) returns (google.protobuf.Int32Value);

  // Получить список подключенных клиентов
  rpc GetConnectedClients(GetClientsRequest) returns (GetClientsResponse);

  // Отключить клиента
  rpc DisconnectClient(DisconnectClientRequest) returns (DisconnectClientResponse);

    // Открыть порт (сделать active=true)
  rpc OpenPort(PortIdentifier) returns (PortOperationResponse);

  // Закрыть порт (сделать active=false)
  rpc ClosePort(PortIdentifier) returns (PortOperationResponse);

  // Добавить новый порт в конфигурацию (изначально неактивен)
  rpc AddPort(PortDefinition) returns (PortOperationResponse);

  // Удалить порт из конфигурации
  rpc DeletePort(PortIdentifier) returns (PortOperationResponse);
}



message GetStatusRequest {}

message GetStatusResponse {
  bool nats_connected = 1;
  repeated PortStatus ports = 2;
}

message PortStatus {
  string id = 1;      //  Уникальный ID порта
  string name = 2;    // "EGTS", "Arnavi", "NDTP"
  int32 port = 3;     // Номер порта
  bool is_open = 4;   // Открыт ли порт сейчас
}

message GetClientsRequest {
  string protocol_name = 1;
}

message ClientInfo {
  string id = 1;
  string address = 2;
  int64 connected_since = 3;
}

message GetClientsResponse {
  repeated ClientInfo clients = 1;
}

message DisconnectClientRequest {
  string protocol_name = 1;
  string client_address = 2;
}

message DisconnectClientResponse {
  bool success = 1;
}

message PortIdentifier {
  string id = 1; // Уникальный ID порта
}

message PortDefinition {
  string name = 1; // Имя протокола (EGTS, ARNAVI, NDTP)
  int32 port = 2;  // Номер порта
}

message PortOperationResponse {
  bool success = 1;
  string message = 2; // Описание результата или ошибки
  PortDefinition port_details = 3; // Детали созданного/измененного порта
}
